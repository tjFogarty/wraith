/*! wraith 2014-03-14 */
var InstantClick=function(a,b){function c(a){var b=a.indexOf("#");return 0>b?a:a.substr(0,b)}function d(a){for(;"A"!=a.nodeName;)a=a.parentNode;return a}function e(a){do{if(!a.hasAttribute)break;if(a.hasAttribute("data-instant"))return!1;if(a.hasAttribute("data-no-instant"))return!0}while(a=a.parentNode);return!1}function f(a){do{if(!a.hasAttribute)break;if(a.hasAttribute("data-no-instant"))return!1;if(a.hasAttribute("data-instant"))return!0}while(a=a.parentNode);return!1}function g(a,b){for(var c=0;c<N[a].length;c++)N[a][c](b)}function h(b,d,e,f){if(a.title=b,a.documentElement.replaceChild(d,a.body),e){history.pushState(null,null,e);var h=e.indexOf("#"),i=h>-1&&a.getElementById(e.substr(h+1)),j=0;if(i)for(;i.offsetParent;)j+=i.offsetTop,i=i.offsetParent;scrollTo(0,j),v=c(e)}else scrollTo(0,f);q(),O.done(),g("change",!1)}function i(){K=!1,L=!1}function k(a){r(d(a.target).href)}function l(a){var b=d(a.target);b.addEventListener("mouseout",o),B?(w=b.href,x=setTimeout(r,B)):r(b.href)}function m(a){var b=d(a.target);A?b.removeEventListener("mousedown",k):b.removeEventListener("mouseover",l),r(b.href)}function n(a){a.which>1||a.metaKey||a.ctrlKey||(a.preventDefault(),s(d(a.target).href))}function o(){return x?(clearTimeout(x),void(x=!1)):void(K&&!L&&(y.abort(),i()))}function p(){if(!(y.readyState<4)&&0!=y.status){if(J.ready=+new Date-J.start,g("receive"),y.getResponseHeader("Content-Type").match(/\/(x|ht|xht)ml/)){var b=a.implementation.createHTMLDocument("");b.documentElement.innerHTML=y.responseText,G=b.title,I=b.body;var d=c(F);E[d]={body:I,title:G,scrollY:d in E?E[d].scrollY:0};for(var e,f,h=b.head.children,i=0,j=h.length-1;j>=0;j--)if(e=h[j],e.hasAttribute("data-instant-track")){f=e.getAttribute("href")||e.getAttribute("src")||e.innerHTML;for(var k=M.length-1;k>=0;k--)M[k]==f&&i++}i!=M.length&&(H=!0)}else H=!0;L&&(L=!1,s(F))}}function q(d){for(var g,h=a.getElementsByTagName("a"),i=b.protocol+"//"+b.host,o=h.length-1;o>=0;o--)g=h[o],g.target||g.hasAttribute("download")||0!=g.href.indexOf(i+"/")||g.href.indexOf("#")>-1&&c(g.href)==v||(z?!f(g):e(g))||(g.addEventListener("touchstart",m),A?g.addEventListener("mousedown",k):g.addEventListener("mouseover",l),g.addEventListener("click",n));if(!d){var p,q,r,s,t=a.body.getElementsByTagName("script");for(o=0,j=t.length;j>o;o++)p=t[o],p.hasAttribute("data-no-instant")||(q=a.createElement("script"),p.src&&(q.src=p.src),p.innerHTML&&(q.innerHTML=p.innerHTML),r=p.parentNode,s=p.nextSibling,r.removeChild(p),r.insertBefore(q,s))}}function r(a){!A&&"display"in J&&+new Date-(J.start+J.display)<100||(x&&(clearTimeout(x),x=!1),a||(a=w),(!K||a!=F&&!L)&&(K=!0,L=!1,F=a,I=!1,H=!1,J={start:+new Date},g("fetch"),y.open("GET",a),y.send()))}function s(a){return"display"in J||(J.display=+new Date-J.start),x?F&&F!=a?void(b.href=a):(r(a),O.start(0,!0),g("wait"),void(L=!0)):!K||L?void(b.href=a):H?void(b.href=F):I?(E[v].scrollY=pageYOffset,i(),void h(G,I,F)):(O.start(0,!0),g("wait"),void(L=!0))}function t(){if(!v){if(!P)return void g("change",!0);for(var d=arguments.length-1;d>=0;d--){var e=arguments[d];e===!0?z=!0:"mousedown"==e?A=!0:"number"==typeof e&&(B=e)}v=c(b.href),E[v]={body:a.body,title:a.title,scrollY:pageYOffset};for(var f,i,j=a.head.children,d=j.length-1;d>=0;d--)f=j[d],f.hasAttribute("data-instant-track")&&(i=f.getAttribute("href")||f.getAttribute("src")||f.innerHTML,M.push(i));y=new XMLHttpRequest,y.addEventListener("readystatechange",p),q(!0),O.init(),g("change",!0),addEventListener("popstate",function(){var a=c(b.href);if(a!=v){if(!(a in E))return void(b.href=b.href);E[v].scrollY=pageYOffset,v=a,h(E[a].title,E[a].body,!1,E[a].scrollY)}})}}function u(a,b){N[a].push(b)}var v,w,x,y,z,A,B,C=navigator.userAgent,D="createTouch"in a,E={},F=!1,G=!1,H=!1,I=!1,J={},K=!1,L=!1,M=[],N={fetch:[],receive:[],wait:[],change:[]},O=function(){function b(){i=a.createElement("div"),i.id="instantclick",j=a.createElement("div"),j.id="instantclick-bar",j.className="instantclick-bar",i.appendChild(j);var b=["Webkit","Moz","O"];if(k="transform",!(k in j.style))for(var c=0;3>c;c++)b[c]+"Transform"in j.style&&(k=b[c]+"Transform");var d="transition";if(!(d in j.style))for(var c=0;3>c;c++)b[c]+"Transition"in j.style&&(d="-"+b[c].toLowerCase()+"-"+d);var e=a.createElement("style");e.innerHTML="#instantclick{position:"+(D?"absolute":"fixed")+";top:0;left:0;width:100%;pointer-events:none;z-index:2147483647;"+d+":opacity .25s .1s}.instantclick-bar{background:#29d;width:100%;margin-left:-100%;height:2px;"+d+":all .25s}",a.head.appendChild(e),D&&(h(),addEventListener("resize",h),addEventListener("scroll",h))}function c(b,c){l=b,a.getElementById(i.id)&&a.body.removeChild(i),i.style.opacity="1",a.getElementById(i.id)&&a.body.removeChild(i),f(),c&&setTimeout(d,0),clearTimeout(m),m=setTimeout(e,500)}function d(){l=10,f()}function e(){l+=1+2*Math.random(),l>=98?l=98:m=setTimeout(e,500),f()}function f(){j.style[k]="translate("+l+"%)",a.getElementById(i.id)||a.body.appendChild(i)}function g(){return a.getElementById(i.id)?(clearTimeout(m),l=100,f(),void(i.style.opacity="0")):(c(100==l?0:l),void setTimeout(g,0))}function h(){i.style.left=pageXOffset+"px",i.style.width=innerWidth+"px",i.style.top=pageYOffset+"px";var a=innerWidth/screen["undefined"!=typeof window.orientation&&90==Math.abs(orientation)?"height":"width"]*2;i.style[k]="scaleY("+a+")"}var i,j,k,l,m;return{init:b,start:c,done:g}}(),P="pushState"in history&&(!C.match("Android")||C.match("Chrome/"))&&"file:"!=b.protocol;return{supported:P,init:t,on:u}}(document,location);!function(a){"use strict";a(document).ready(function(){InstantClick.on("change",function(){ga("send","pageview",location.pathname+location.search)}),InstantClick.init()})}(jQuery);